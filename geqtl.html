<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gene-based eQTL Search</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Calibri, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }

        .search-container {
            text-align: center;
            margin: 20px 0;
        }

        #geneSymbol {
            padding: 8px;
            width: 300px;
            font-size: 16px;
        }

        button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background-color: #45a049;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        #results {
            display: none;
        }

        .error {
            color: red;
            text-align: center;
            margin: 20px 0;
            display: none;
        }

        .gene-header {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .check {
            color: green;
        }

        .cross {
            color: red;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }

        .scroll-table {
            max-height: 400px;
            overflow-y: auto;
            display: block;
        }

        details {
            margin: 15px 0;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
        }

        summary {
            font-weight: bold;
            cursor: pointer;
            padding: 5px;
        }

        .availability {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 15px 0;
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
        }

        .availability-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
    </style>
</head>

<body>
    <h1>Gene-based eQTL Search</h1>
    <p>Enter a gene symbol to search for its information.</p>

    <div class="search-container">
        <input type="text" id="geneSymbol" placeholder="Enter gene symbol (e.g., 2'-PDE)">
        <button onclick="searchGene()">Search</button>
    </div>

    <div id="loading" class="loading">
        <p>Loading data...</p>
    </div>

    <div id="error" class="error">
        <p>No information found for this gene symbol.</p>
    </div>

    <div id="results">
        <div class="gene-header">Gene: <span id="geneTitle"></span> (<span id="geneID"></span>)</div>

        <div class="availability" id="availability">
            <!-- Data availability will be dynamically added here -->
        </div>

        <details id="sgeneDetails">
            <summary>S-gene Information (<span id="sgeneCount">0</span> genes)</summary>
            <div class="scroll-table">
                <table id="sgeneTable">
                    <thead>
                        <tr>
                            <th>S-gene</th>
                            <th>CEU</th>
                            <th>CHB</th>
                            <th>JPT</th>
                            <th>YRI</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Sgene data will be dynamically added here -->
                    </tbody>
                </table>
            </div>
        </details>

        <details id="tgeneDetails">
            <summary>T-gene Information (<span id="tgeneCount">0</span> genes)</summary>
            <div class="scroll-table">
                <table id="tgeneTable">
                    <thead>
                        <tr>
                            <th>T-gene</th>
                            <th>CEU</th>
                            <th>CHB</th>
                            <th>JPT</th>
                            <th>YRI</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Tgene data will be dynamically added here -->
                    </tbody>
                </table>
            </div>
        </details>
    </div>

    <script>
        function searchGene() {
            const geneSymbol = document.getElementById('geneSymbol').value.trim();

            if (!geneSymbol) {
                alert('Please enter a gene symbol.');
                return;
            }

            // Show loading, hide results and error
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('error').style.display = 'none';

            // Construct the URL
            const url = `https://raw.githubusercontent.com/0jiawei0/eQTL-HapMapII/refs/heads/main/geQTL/${encodeURIComponent(geneSymbol)}.json`;

            // Fetch the data
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Gene not found');
                    }
                    return response.json();
                })
                .then(data => {
                    displayData(data);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('results').style.display = 'block';
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('error').style.display = 'block';
                });
        }

        function displayData(data) {
            // Set gene title and ID
            document.getElementById('geneTitle').textContent = data.gsym[0];
            document.getElementById('geneID').textContent = data.gid[0];

            // Display data availability
            const availabilityDiv = document.getElementById('availability');
            availabilityDiv.innerHTML = '';

            // Extract dtype information
            const dtypeData = data.dtype[0][0];

            // Define all possible data types
            const dataTypes = [
                { key: 'GE', display: 'GE' },
                { key: 'IG.CEU', display: 'IG(CEU)' },
                { key: 'IG.YRI', display: 'IG(YRI)' },
                { key: 'IG.CHB', display: 'IG(CHB)' },
                { key: 'IG.JPT', display: 'IG(JPT)' }
            ];

            // Create availability indicators
            dataTypes.forEach(type => {
                const value = dtypeData[type.key] || 0;
                const availabilityItem = document.createElement('div');
                availabilityItem.className = 'availability-item';

                const icon = value === 1 ?
                    '<i class="fa fa-check check"></i>' :
                    '<i class="fa fa-times cross"></i>';

                availabilityItem.innerHTML = `${type.display} ${icon}`;
                availabilityDiv.appendChild(availabilityItem);
            });

            // Process Sgene data
            const sgeneData = data.Sgene[0];
            const sgeneTableBody = document.getElementById('sgeneTable').getElementsByTagName('tbody')[0];
            sgeneTableBody.innerHTML = '';

            sgeneData.forEach(gene => {
                const row = document.createElement('tr');

                // Gene symbol with NCBI link
                const symbolCell = document.createElement('td');
                symbolCell.innerHTML = `<a href="https://www.ncbi.nlm.nih.gov/gene/${gene.Sgid}" target="_blank">${gene.Sgsym}</a>`;
                row.appendChild(symbolCell);

                // Population data cells
                ['CEU', 'CHB', 'JPT', 'YRI'].forEach(pop => {
                    const cell = document.createElement('td');
                    if (gene[pop] === 1) {
                        cell.innerHTML = '<i class="fa fa-check check"></i>';
                    }
                    row.appendChild(cell);
                });

                sgeneTableBody.appendChild(row);
            });

            // Update Sgene count
            document.getElementById('sgeneCount').textContent = sgeneData.length;

            // Process Tgene data
            const tgeneData = data.Tgene[0];
            const tgeneTableBody = document.getElementById('tgeneTable').getElementsByTagName('tbody')[0];
            tgeneTableBody.innerHTML = '';

            tgeneData.forEach(gene => {
                const row = document.createElement('tr');

                // Gene symbol with NCBI link
                const symbolCell = document.createElement('td');
                symbolCell.innerHTML = `<a href="https://www.ncbi.nlm.nih.gov/gene/${gene.Tgid}" target="_blank">${gene.Tgsym}</a>`;
                row.appendChild(symbolCell);

                // Population data cells
                ['CEU', 'CHB', 'JPT', 'YRI'].forEach(pop => {
                    const cell = document.createElement('td');
                    if (gene[pop] === 1) {
                        cell.innerHTML = '<i class="fa fa-check check"></i>';
                    }
                    row.appendChild(cell);
                });

                tgeneTableBody.appendChild(row);
            });

            // Update Tgene count
            document.getElementById('tgeneCount').textContent = tgeneData.length;

            // Open details if less than 10 items
            if (sgeneData.length <= 10) {
                document.getElementById('sgeneDetails').open = true;
            }

            if (tgeneData.length <= 10) {
                document.getElementById('tgeneDetails').open = true;
            }
        }
    </script>
</body>

</html>